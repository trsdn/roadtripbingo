<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Generation Test - Non-Square Icons</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-container { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .test-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 300px; margin: 20px 0; }
        .test-cell { 
            width: 80px; 
            height: 80px; 
            border: 1px solid #333; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            background: white;
        }
        .test-cell img { 
            max-width: 70px; 
            max-height: 70px; 
            width: auto; 
            height: auto; 
            object-fit: contain; 
        }
        button { padding: 10px 20px; font-size: 16px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>PDF Generation Test - Non-Square Icons</h1>
    
    <div class="test-container">
        <h2>Test Grid (Visual Preview)</h2>
        <p>This simulates how a 3x3 bingo card would look with non-square icons:</p>
        <div class="test-grid">
            <div class="test-cell"><img src="icons/DD.png" alt="DD"></div>
            <div class="test-cell"><img src="icons/airplane.png" alt="Airplane"></div>
            <div class="test-cell"><img src="icons/WOB.png" alt="WOB"></div>
            <div class="test-cell"><img src="icons/bus.png" alt="Bus"></div>
            <div class="test-cell"><img src="icons/DD.png" alt="DD"></div>
            <div class="test-cell"><img src="icons/police.png" alt="Police"></div>
            <div class="test-cell"><img src="icons/WOB.png" alt="WOB"></div>
            <div class="test-cell"><img src="icons/truck.png" alt="Truck"></div>
            <div class="test-cell"><img src="icons/airplane.png" alt="Airplane"></div>
        </div>
    </div>
    
    <div class="test-container">
        <h2>PDF Generation Test</h2>
        <p>Click the button below to test PDF generation with non-square icons:</p>
        <button onclick="generateTestPDF()">Generate Test PDF with Non-Square Icons</button>
        <div id="status"></div>
    </div>
    
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script>
        async function generateTestPDF() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = 'Generating PDF...';
            
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                
                // Test icons with different aspect ratios
                const testIcons = [
                    { src: 'icons/DD.png', name: 'DD (520x110)' },
                    { src: 'icons/WOB.png', name: 'WOB (520x110)' },
                    { src: 'icons/airplane.png', name: 'Airplane (1024x1024)' }
                ];
                
                pdf.setFontSize(16);
                pdf.text('Non-Square Icon Test', 10, 20);
                
                let yPos = 40;
                
                for (let i = 0; i < testIcons.length; i++) {
                    const icon = testIcons[i];
                    
                    // Add icon name
                    pdf.setFontSize(12);
                    pdf.text(icon.name, 10, yPos);
                    
                    try {
                        // Load the image
                        const img = new Image();
                        img.crossOrigin = 'anonymous';
                        
                        await new Promise((resolve, reject) => {
                            img.onload = () => {
                                // Calculate aspect ratio preserving dimensions
                                const maxSize = 30; // Max size in PDF units
                                const aspectRatio = img.width / img.height;
                                
                                let width, height;
                                if (aspectRatio > 1) {
                                    // Wide image
                                    width = maxSize;
                                    height = maxSize / aspectRatio;
                                } else {
                                    // Tall image or square
                                    height = maxSize;
                                    width = maxSize * aspectRatio;
                                }
                                
                                // Center the image in a fixed box
                                const boxSize = 35;
                                const x = 60 + (boxSize - width) / 2;
                                const y = yPos - 5 + (boxSize - height) / 2;
                                
                                // Draw a border for the container
                                pdf.setDrawColor(0, 0, 0);
                                pdf.rect(60, yPos - 5, boxSize, boxSize);
                                
                                // Add the image
                                const canvas = document.createElement('canvas');
                                const ctx = canvas.getContext('2d');
                                canvas.width = img.width;
                                canvas.height = img.height;
                                ctx.drawImage(img, 0, 0);
                                const imgData = canvas.toDataURL('image/png');
                                
                                pdf.addImage(imgData, 'PNG', x, y, width, height);
                                
                                resolve();
                            };
                            img.onerror = reject;
                            img.src = icon.src;
                        });
                        
                    } catch (error) {
                        console.error(`Error loading ${icon.src}:`, error);
                        pdf.text(`Error loading ${icon.name}`, 60, yPos);
                    }
                    
                    yPos += 50;
                }
                
                // Save the PDF
                pdf.save('non-square-icon-test.pdf');
                statusDiv.innerHTML = '<span style="color: green;">✅ PDF generated successfully! Check your downloads folder.</span>';
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                statusDiv.innerHTML = `<span style="color: red;">❌ Error: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>
